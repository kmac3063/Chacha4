{"version":3,"sources":["panels/Home.js","img/persik.png","panels/Choose.js","panels/WelcomeScreen.js","App.js","index.js"],"names":["Home","id","go","fetchedUser","host","scheme","status","db","useState","currentSecond","setCurrentSecond","myInterval","setMyInterval","stateString","setStateString","useEffect","connectTimer","console","log","docRef","doc","toString","setInterval","getDoc","then","snap","exists","data","clearInterval","setDoc","length","run","bridge","send","switchChange","index","value","prev1","res","slice","sec","parseInt","timerId","prev","left","onClick","data-to","style","display","size","stretched","marginRight","mode","before","first_name","last_name","justifyContent","overflow","split","map","symb","padding","backgroundColor","onChange","e","target","disabled","multiline","Choose","connect","WelcomeScreen","icon","header","action","App","activePanel","setActivePanel","setUser","popout","setPopout","setScheme","friend","setFriend","setStatus","firebaseApp","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","getFirestore","a","user","p","is_available","alert","subscribe","detail","type","schemeAttribute","document","createAttribute","body","attributes","setNamedItem","fetchData","checkAvailable","currentTarget","dataset","to","users","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.39bb2360.chunk.js","sourcesContent":["import React, {useEffect, useState} from 'react';\n\nimport {Button, Cell, Div, Group, Header, Panel, PanelHeader, PanelHeaderBack, Switch} from '@vkontakte/vkui';\nimport bridge from \"@vkontakte/vk-bridge\";\nimport {doc, getDoc, setDoc} from \"firebase/firestore/lite\";\nimport {Icon28UserOutline} from \"@vkontakte/icons\";\n\n\nconst Home = ({id, go, fetchedUser, scheme, host, status, db}) => {\n    const [currentSecond, setCurrentSecond] = useState(0)\n    const [myInterval, setMyInterval] = useState(null)\n    const [stateString, setStateString] = useState(\"00000000P\")\n\n    useEffect(() => {\n        let connectTimer = null\n        if (status === \"connect\") {\n            if (host === null) {\n                return\n            }\n            console.log(host)\n            const docRef = doc(db, 'hs', host.id.toString())\n            connectTimer = setInterval(() => {\n                getDoc(docRef).then(snap => {\n                    if (snap.exists()) {\n                        setStateString(() => snap.data().stateString)\n                    }\n                })\n            }, 100)\n        }\n        return () => {\n            if (connectTimer !== null) {\n                clearInterval(connectTimer)\n            }\n        }\n    }, [])\n\n    useEffect(() => {\n        if (status === \"host\") {\n            setDoc(doc(db, 'hs', fetchedUser.id.toString()), {\n                stateString: stateString,\n            })\n        }\n\n        if (stateString[stateString.length - 1] === \"R\") {\n            run()\n        } else {\n            clearInterval(myInterval)\n            setCurrentSecond(0)\n            bridge.send(\"VKWebAppFlashSetLevel\", {\"level\": 0});\n        }\n    }, [stateString])\n\n    const switchChange = (index, value) => {\n        setStateString((prev1) => {\n            let res = prev1.slice(0, index)\n                + (prev1[index] === '1' ? '0' : '1') + prev1.slice(index + 1, 8) + \"P\"\n            console.log(res)\n            return res\n        })\n    }\n\n    const startPressed = () => {\n        setStateString((prev) => prev.slice(0, 8) + \"R\")\n    }\n\n    const stopPressed = () => {\n        setStateString((prev) => prev.slice(0, 8) + \"P\")\n    }\n\n    const run = () => {\n        let sec = 0\n        setCurrentSecond(1)\n        bridge.send(\"VKWebAppFlashSetLevel\", {\"level\": parseInt(stateString[0])});\n        let timerId = setInterval(() => {\n            setCurrentSecond((prev) => 1 + (prev) % 8)\n            sec = (sec + 1) % 8\n            bridge.send(\"VKWebAppFlashSetLevel\", {\"level\": parseInt(stateString[sec])});\n        }, 1000);\n        setMyInterval(timerId)\n    }\n\n    return <Panel id={id}>\n        <PanelHeader\n            left={<PanelHeaderBack onClick={go} data-to={'Choose'}/>}\n        >{status === \"host\" ? \"Диджей\" : \"Слушатель\"}</PanelHeader>\n        {status === \"host\" ?\n            <Group>\n                <Div style={{display: 'flex'}}>\n                    <Button size=\"l\" stretched style={{marginRight: 8}}\n                            onClick={startPressed}>Начать</Button>\n                    <Button size=\"l\" stretched mode=\"secondary\" onClick={stopPressed}>Остановить</Button>\n                </Div>\n            </Group> :\n            <Cell before={<Icon28UserOutline/>}>{host !== null? host.first_name + \" \" + host.last_name : \"...\"}</Cell>}\n        <Group>\n            <Header mode=\"secondary\">Управление секундами</Header>\n            <Div style={{display: \"flex\", justifyContent: \"space-between\", overflow: \"auto\"}}>\n                {stateString.split('').map((symb, index) => {\n                    if (symb !== '0' && symb !== '1') return null\n                    return <Div key={index} style={{\n                        padding: \"0\",\n                        backgroundColor: index + 1 === currentSecond ? \"#D7FDDB\" : \"#FFFFFF\"\n                    }}>\n                        <Div style={{padding: \"0\"}}>{index + 1} сек</Div>\n                        {status === \"host\" ?\n                            <Switch value={symb === \"1\"}\n                                    onChange={(e) => switchChange(index, e.target.value)}/> :\n                            <Switch value={symb === \"1\"} disabled\n                                    onChange={(e) => switchChange(index, e.target.value)}/>}\n                    </Div>\n                })\n                }\n            </Div>\n        </Group>\n        <Group>\n            <Header mode=\"secondary\">{status === \"host\" ? \"Это ваша комната\" : \"Вы слушитель\"}</Header>\n            <Cell multiline>{status === \"host\" ?\n                \"Все подключившиеся к вам люди будут получать сигнал о включении фонарика в один момент с вами\" :\n                \"Ждите, пока владелец комнаты включит вам фонарик!\"\n            }</Cell>\n        </Group>\n    </Panel>\n}\n\nexport default Home;\n","export default __webpack_public_path__ + \"static/media/persik.ae9f0072.png\";","import React, {useState} from 'react';\nimport PropTypes from 'prop-types';\n\nimport {\n    Panel,\n    PanelHeader,\n    Header,\n    Button,\n    Group,\n    Cell,\n    Div,\n    Avatar,\n    SimpleCell,\n    Switch,\n    FormItem, Select\n} from '@vkontakte/vkui';\nimport bridge from \"@vkontakte/vk-bridge\";\n\nconst Choose = ({id, go, fetchedUser, scheme, connect, host}) => {\n    return <Panel id={id}>\n        <PanelHeader>Один-ноль фонарик</PanelHeader>\n        <Group>\n            <Div style={{display: 'flex'}}>\n                <Button size=\"l\" stretched style={{marginRight: 8}} onClick={connect} data-to={\"Home\"}>Подключиться</Button>\n                <Button size=\"l\" stretched mode=\"secondary\" onClick={host} data-to={\"Home\"}>Быть диджеем</Button>\n            </Div>\n        </Group>\n    </Panel>\n}\n\nexport default Choose;\n","import React from \"react\";\r\nimport {Button, Group, Panel, PanelHeader, PanelHeaderBack, Placeholder} from \"@vkontakte/vkui\";\r\nimport persik from \"../img/persik.png\";\r\nimport {Icon56UsersOutline} from \"@vkontakte/icons\";\r\nimport Choose from \"./Choose\";\r\n\r\nconst WelcomeScreen = ({id, fetchedUser, go}) => {\r\n    const getName = (user) => {\r\n        // if (user == null || user.first_name == null)\r\n        //     return \"Друже\"\r\n        // return fetchedUser.first_name\r\n        return \"Приятель\"\r\n    }\r\n\r\n    return (\r\n        <Panel id={id}>\r\n            {/*<PanelHeader right={<Avatar size={36} />}>Panel 1</PanelHeader>*/}\r\n            <Group>\r\n                <Placeholder\r\n                    icon={<Icon56UsersOutline />}\r\n                    header={\"Приветствуем, \" + getName(fetchedUser) + \"!\"}\r\n                    action={<Button size=\"m\" onClick={go} data-to=\"Choose\">Перейти к фонарику</Button>}\r\n                >\r\n                    Приложение разработано в рамках хакатона \"Вездекод 2021\"\r\n                </Placeholder>\r\n            </Group>\r\n        </Panel>\r\n    )\r\n}\r\n\r\nexport default WelcomeScreen;","import React, {useEffect, useState} from 'react';\nimport bridge from '@vkontakte/vk-bridge';\nimport {AdaptivityProvider, AppRoot, ScreenSpinner, View} from '@vkontakte/vkui';\nimport '@vkontakte/vkui/dist/vkui.css';\n\nimport Home from './panels/Home';\nimport WelcomeScreen from \"./panels/WelcomeScreen\";\nimport Choose from \"./panels/Choose\";\n\nimport {initializeApp} from \"firebase/app\";\nimport {getFirestore} from 'firebase/firestore/lite';\n\nconst App = () => {\n    const [activePanel, setActivePanel] = useState('Choose');\n    const [fetchedUser, setUser] = useState(null);\n    const [popout, setPopout] = useState(<ScreenSpinner size='large'/>);\n    const [scheme, setScheme] = useState(null)\n    const [friend, setFriend] = useState(null)\n    const [status, setStatus] = useState(\"connect\")\n\n    // const schemeAttribute = document.createAttribute('scheme');\n    // schemeAttribute.value = 'dark';\n    // document.body.attributes.setNamedItem(schemeAttribute);\n    const d = true\n\n    const firebaseConfig = {\n        apiKey: \"AIzaSyA4pTIWp427xU-6UKZhMS5gm7jgZpnjTaM\",\n        authDomain: \"chacha4-45297.firebaseapp.com\",\n        projectId: \"chacha4-45297\",\n        storageBucket: \"chacha4-45297.appspot.com\",\n        messagingSenderId: \"908778198952\",\n        appId: \"1:908778198952:web:a3d68cc210e47a638aaf9d\"\n    };\n\n    const firebaseApp = initializeApp(firebaseConfig);\n    const db = getFirestore(firebaseApp)\n\n    useEffect(() => {\n        bridge.subscribe(({detail: {type, data}}) => {\n            if (type === 'VKWebAppUpdateConfig') {\n                const schemeAttribute = document.createAttribute('scheme')\n                // schemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n                schemeAttribute.value = 'client_light';\n                setScheme(schemeAttribute.value)\n                document.body.attributes.setNamedItem(schemeAttribute);\n            }\n        });\n\n        async function fetchData() {\n            setPopout(null);\n            const user = await bridge.send('VKWebAppGetUserInfo');\n            setUser(user);\n        }\n\n        async function checkAvailable() {\n            bridge.send(\"VKWebAppFlashGetInfo\").then(\n                (p) => {\n                    if (!p.is_available) {\n                        alert(\"На вашем устройстве отсутствует/не работает фонарик :(\")\n                    }\n                }\n            )\n        }\n\n\n        fetchData();\n        checkAvailable()\n    }, []);\n\n    const go = e => {\n        setActivePanel(e.currentTarget.dataset.to);\n    };\n\n    const connect = () => {\n        bridge.send('VKWebAppGetFriends', {}).then(data => {\n            setFriend(() => data.users[0])\n            setStatus(\"connect\")\n            setActivePanel(() => 'Home')\n        })\n\n        if (d) {\n            let a = {\n                \"id\": 2884043,\n                \"first_name\": \"Albert\",\n                \"last_name\": \"Usmanov\",\n                \"sex\": 2,\n                \"photo_200\": \"...\"\n            }\n\n            setUser({id: 0})\n            setFriend(() => a)\n            setStatus(\"connect\")\n            setActivePanel(() => 'Home')\n        }\n    }\n\n    const host = () => {\n        setStatus(\"host\")\n        setActivePanel(() => 'Home')\n        setFriend(() => null)\n\n        if (d) {\n            setUser({id: 0})\n        }\n    }\n\n    return (\n        <AdaptivityProvider>\n            <AppRoot>\n                <View activePanel={activePanel} popout={popout}>\n                    <WelcomeScreen id='WelcomeScreen' fetchedUser={fetchedUser} go={go}/>\n                    <Choose id='Choose' fetchedUser={fetchedUser} go={go} connect={connect} host={host}/>\n                    <Home id='Home' fetchedUser={fetchedUser} go={go}\n                          host={friend} status={status} db={db}\n                    />\n                </View>\n            </AppRoot>\n        </AdaptivityProvider>\n    );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\nif (process.env.NODE_ENV === \"development\") {\n  import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\n}\n"],"sourceRoot":""}